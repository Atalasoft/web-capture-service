var Atalasoft=Atalasoft||{};Atalasoft.Controls=Atalasoft.Controls||{},Atalasoft.Controls.Capture=Atalasoft.Controls.Capture||{},Atalasoft.Controls.Capture.concatenated=!0,Atalasoft.Controls.Capture.minVersion=[2,0,0,804];var Atalasoft;!function(e){"use strict";function t(t,n){var a=window.console;return function(){return(n||Atalasoft.TraceEnabled)&&a&&a[t]&&"function"==typeof a[t]&&a[t].apply(a,arguments),e.Logger}}var n={},a=t("group"),r=t("groupEnd"),o=t("time"),i=t("timeEnd"),s=function(){var e=0;return function(){return e+=1,"Time Sequence "+e}}();e.Logger={error:t("error",!0),warn:t("warn",!0),log:t("log"),info:t("info"),object:t("dir"),debug:t("debug"),deprecate:function(e,t){n[e]||(n[e]=t,this.warn("'%s' is deprecated. Please use '%s' instead.",e,t))},scope:function(){var e=Array.prototype.slice.call(arguments),t=e.pop();if(Atalasoft.TraceEnabled){var n=s();a.apply(this,e),o(n);try{t()}finally{i(n),r()}}else t()}}}(Atalasoft||(Atalasoft={})),function(e){Atalasoft.Controls.Capture.CaptureService={__resetFields:function(){this._params={},this.contentType="",this.contentTypeDescriptionName="",this.contentTypeDescription={},this.contentTypeDescriptionArray=[],this.documentFilename="",this.currentImportId="",this.currentStatus="",this.loosePages=!1,this.loosePageDisplayName="",this.indexFieldsForDocumentClass={},this.indexFieldsForDocumentClassArray=[],this.indexFieldValuesForDisplay={},this.batchFieldValuesForDisplayList={},this.batchFieldArray=[],this.fieldValuesForImport={},this.customValidationCollection={}},__getContentTypeDocs:function(t){var n=this;this.getContentTypeDescription(t,function(a){var r=e(".atala-content-type-document-list")[0];if(r){for(;r.length>0;)r.remove(0);if(void 0!==n._params.removedContentTypeDescriptions){var o=n.__filterContentTypeDescriptionList(a,n._params.removedContentTypeDescriptions);n.__buildContentTypeDescriptionDropDown(n,t,o,r)}else n.__buildContentTypeDescriptionDropDown(n,t,a,r);void 0!==n._params.onContentTypeDescriptionsCreated&&n._params.onContentTypeDescriptionsCreated()}},function(e,t){n._params.onError(e,{statusText:t.xhr.statusText})})},__filterContentTypeDescriptionList:function(t,n){for(var a=[],r=n.split(","),o=0;o<r.length;o++)r[o]=e.trim(r[o]);for(var i=0;i<t.length;i++)-1===this.__inArray(t[i].documentClass,r)&&a.push(t[i]);return a},__buildContentTypeDescriptionDropDown:function(t,n,a,r){t.contentTypeDescriptionArray=a,t.contentTypeDescription=a[0];for(var o in a){var i=new Option(a[o].documentClass);r.add(i)}if(t.loosePages===!0)if(void 0!==t._params.displayedLoosePagesForContentType){for(var s=t._params.displayedLoosePagesForContentType.split(","),l=0;l<s.length;l++)s[l]=e.trim(s[l]);-1!==this.__inArray(n,s)&&t.__addLoosePageOption(r,t.loosePageDisplayName)}else t.__addLoosePageOption(r,t.loosePageDisplayName);(e(".atala-indexfield-list").length>0||e(".atala-batchfield-list").length>0)&&t.__getIndexAndBatchFields(t.contentType,t.contentTypeDescription)},__addLoosePageOption:function(e,t){var n;n=void 0===t?new Option(""):new Option(t),e.add(n)},__getContentTypeDocsWithNoUI:function(e,t){var n=this;n.contentTypeDescriptionName=t,this.getContentTypeDescription(e,function(e){n.contentTypeDescriptionArray=e;for(var t in e)e[t].documentClass===n.contentTypeDescriptionName&&(n.contentTypeDescription=e[t])},function(e,t){n._params.onError(e,{statusText:t.xhr.statusText})})},__getIndexAndBatchFields:function(t,n){var a,r=this,o="";if(void 0!==n){var i=n.documentClass,s=[],l=this.__inArray(" / ",i);-1!==l?(s=i.split(" / "),o=s[0]):o=i}if(""===this._params.displayedIndexFields||void 0===this._params.displayedIndexFields)r.indexFieldsForDocumentClass="";else{var c=this._params.displayedIndexFields.split(",");for(a=0;a<c.length;a++)c[a]=e.trim(c[a]);r.indexFieldsForDocumentClass=c}void 0!==n?(e(".atala-batchfield-list").length>0&&r.__buildBatchFieldTable(r._params.displayedBatchFields,t,!0),this.getIndexFieldsForDocumentClass(t,o,function(t){e(".atala-indexfield-list").length>0&&((0!==e("#atala-indexfield-table tr").length||void 0!==e("#atala-indexfield-table"))&&e("#atala-indexfield-table").remove(),e("<table id=atala-indexfield-table></table>").appendTo(".atala-indexfield-list"),r.indexFieldsForDocumentClassArray=t,""===r.indexFieldsForDocumentClass||void 0===r.indexFieldsForDocumentClass?r.__drawIndexFieldTable(t,!0):r.__drawIndexFieldTable(t,!1),void 0!==r._params.onIndexFieldsCompleted&&r._params.onIndexFieldsCompleted(!0))},function(e){r._params.onError(e,{statusText:e.xhr.statusText})})):r.__buildBatchFieldTable(r._params.displayedBatchFields,t,!1)},__drawIndexFieldTable:function(t,n){for(var a=this,r=0;r<t.length;r++){var o="",i=t[r].indexField.split(" / "),s=i[1].split(" ^ "),l=s[1],c=s[2];if("true"===l&&(o=' class="atala-indexfield-required"'),"true"===c&&(o=' class="atala-field-hidden"'),n||-1!==this.__inArray(i[0],a.indexFieldsForDocumentClass)){var u=a.__replaceWhiteSpace(i[0])+"_indexFieldInputId";e("<tr><td><label"+o+" for='"+u+"'>"+i[0]+"</label></td><td><input type='text' "+o+" id='"+u+"' /></td></tr>").appendTo("#atala-indexfield-table")}void 0!==a._params.onIndexFieldCompleted&&a._params.onIndexFieldCompleted(i[0])}},__buildBatchFieldTable:function(t,n,a){var r=this;if(""===t||void 0===t)r.batchFieldValuesForDisplayList="";else{for(var o=this._params.displayedBatchFields.split(","),i=0;i<o.length;i++)o[i]=e.trim(o[i]);r.batchFieldValuesForDisplayList=o}a?r.getBatchFields(n,function(t){(0!==e("#atala-batchfield-table tr").length||void 0!==e("#atala-batchfield-table"))&&e("#atala-batchfield-table").remove(),r.batchFieldArray=t,e("<table id=atala-batchfield-table></table>").appendTo(".atala-batchfield-list"),void 0===r._params.displayedBatchFields||""===r._params.displayedBatchFields?r.__drawBatchFieldRow(t,!0):r.__drawBatchFieldRow(t,!1),void 0!==r._params.onBatchFieldsCompleted&&r._params.onBatchFieldsCompleted(!0)},function(e){r._params.onError(e,{statusText:e.xhr.statusText})}):r.getBatchFields(n,function(t){r.batchFieldArray=t;e(".atala-batchfield-list").length>0&&(0!==e("#atala-indexfield-table tr").length||void 0!==e("#atala-indexfield-table"))&&e("#atala-indexfield-table").remove(),e(".atala-indexfield-list").length>0&&0===e(".atala-batchfield-list").length&&((0!==e("#atala-indexfield-table tr").length||void 0!==e("#atala-indexfield-table"))&&e("#atala-indexfield-table").remove(),e("<table id=atala-indexfield-table></table>").appendTo(".atala-indexfield-list"),""===r.batchFieldValuesForDisplayList||void 0===r.batchFieldValuesForDisplayList?r.__drawBatchFieldRow(t,!0):r.__drawBatchFieldRow(t,!1)),void 0!==r._params.onBatchFieldsCompleted&&r._params.onBatchFieldsCompleted(!0)},function(e){r._params.onError(e,{statusTest:e.xhr.statusText})})},__drawBatchFieldRow:function(t,n){for(var a=this,r=0;r<t.length;r++){var o="",i=t[r].batchField.split(" / "),s=i[1].split(" ^ "),l=s[1],c=s[2];if("true"===l&&(o=' class="atala-indexfield-required"'),"true"===c&&(o=' class="atala-field-hidden"'),n||-1!==this.__inArray(i[0],a.batchFieldValuesForDisplayList)){var u=a.__replaceWhiteSpace(i[0])+"_batchFieldInputId",d="<tr><td><label"+o+" for='"+u+"'>"+i[0]+"</label></td><td><input type='text' "+o+" id='"+u+"'/></td></tr>";e(".atala-batchfield-list").length>0?e(d).appendTo("#atala-batchfield-table"):e(d).appendTo("#atala-indexfield-table"),void 0!==a._params.onBatchFieldCompleted&&a._params.onBatchFieldCompleted(i[0])}}},__replaceWhiteSpace:function(e){return e.replace(/\s/g,"_")},__inArray:function(e,t,n){var a,r=Array.prototype.indexOf;if(t){if(r)return r.call(t,e,n);for(a=t.length,n=n?0>n?Math.max(0,a+n):n:0;a>n;n++)if(t[n]===e)return n}return-1},__setCurrentImportId:function(e){this.currentImportId=e},__scrapeFieldValues:function(t,n,a){var r,o,i,s,l,c=[];if(void 0===t)return c;for(index=0;index<t.length;index++)r=n?t[index].batchField.split(" / "):t[index].indexField.split(" / "),o=r[0],i=n?e("#"+a.__replaceWhiteSpace(o)+"_batchFieldInputId").val():e("#"+a.__replaceWhiteSpace(o)+"_indexFieldInputId").val(),s=r[1].split(" ^ "),l=void 0!==i&&""!==i,l||(i=""),n?(o="batchField_"+o,a.fieldValuesForImport[o]=encodeURIComponent(i)):(o="indexField_"+o,a.fieldValuesForImport[o]=encodeURIComponent(i)),"true"!==s[1]||l?c.push(!1):c.push(!0),a.customValidationCollection[o]={},a.customValidationCollection[o].name=o,a.customValidationCollection[o].value=i,a.customValidationCollection[o].fieldType=s[0],a.customValidationCollection[o].required=s[1];return n?void 0!==a._params.onBatchFieldTypeValidationStatus&&a._params.onBatchFieldTypeValidationStatus(a.customValidationCollection):void 0!==a._params.onIndexFieldTypeValidationStatus&&a._params.onIndexFieldTypeValidationStatus(a.customValidationCollection),c},__getFieldListValuesForImport:function(e,t){var n=this,a=[];return void 0!==e&&e.length>0&&a.push(n.__scrapeFieldValues(e,!1,n)),void 0!==t&&t.length>0&&a.push(n.__scrapeFieldValues(t,!0,n)),a},__checkIndexFieldValidationResults:function(e){for(var t,n=0;n<e.length;n++)for(t=0;t<e[n].length;t++)if(e[n][t]===!0)return!1;return!0},__setIndexFieldsWithNoUi:function(t){var n=this,a=t.split(",");if(1===a.length)a[0]=e.trim(a[0]);else for(var r=0;r<a.length;r++)a[r]=e.trim(a[r]);for(var o=0;o<a.length;o++){var i=a[o].split(":");n.fieldValuesForImport["indexField_"+i[0]]=encodeURIComponent(i[1])}},__setBatchFieldsWithNoUi:function(t){var n,a=this,r=t.split(",");for(n=0;n<r.length;n++)r[n]=e.trim(r[n]);for(n=0;n<r.length;n++){var o=r[n].split(":");a.fieldValuesForImport["batchField_"+o[0]]=encodeURIComponent(o[1])}},__setLoosePages:function(t){var n=t.split(",");"true"===n[0]&&(this.loosePages=!0),2===n.length&&(this.loosePageDisplayName=e.trim(n[1]))},__buildContentTypeList:function(e,t,n){for(var a in t){var r=new Option(t[a]);e.add(r)}void 0!==n._params.onContentTypesCreated&&n._params.onContentTypesCreated()},__filterContentTypes:function(t,n,a){var r=[],o=[];void 0!==a&&r.push(a);var i;if(void 0!==n){o=n.split(",");for(var s=0;s<o.length;s++)o[s]=e.trim(o[s]);for(i=0;i<t.length;i++)-1===this.__inArray(t[i],o)&&r.push(t[i])}else for(i=0;i<t.length;i++)t[i]!==a&&r.push(t[i]);return r},__beforeImporting:function(e){var t=!0;return void 0!==e._params.onBeforeImport&&(t=e._params.onBeforeImport()),t},isInitialized:function(){return this._params&&this._params.handlerUrl},initialize:function(t){this.__resetFields(),this._params=t;var n=this,a=[],r=!1;if(void 0!==e(".atala-content-type-list")[0])this.getContentTypeList(function(t){void 0!==n._params.loosePages&&n.__setLoosePages(n._params.loosePages);var o=e(".atala-content-type-list")[0];if(void 0!==n._params.removedContentTypes||void 0!==n._params.defaultContentType){var i=n.__filterContentTypes(t,n._params.removedContentTypes,n._params.defaultContentType);n.__buildContentTypeList(o,i,n),n.contentType=i[0]}else n.__buildContentTypeList(o,t,n),n.contentType=t[0];n.__getContentTypeDocs(n.contentType),e(".atala-content-type-list").change(function(){n.contentType=e(".atala-content-type-list option:selected").text(),n.__getContentTypeDocs(n.contentType)}),e(".atala-content-type-document-list").change(function(){n.contentTypeDescription=n.contentTypeDescriptionArray[e(".atala-content-type-document-list")[0].selectedIndex],void 0!==e(".atala-indexfield-list")&&n.__getIndexAndBatchFields(n.contentType,n.contentTypeDescription)}),e(".atala-import-button").click(function(){n.importDocument(n.documentFilename,n.contentType,n.contentTypeDescription,n._params.onImportCompleted,n._params.onError)}),e(".atala-import-index-field-button").click(function(){void 0!==n.contentTypeDescription?(a=n.__getFieldListValuesForImport(n.indexFieldsForDocumentClassArray,n.batchFieldArray),r=n.__checkIndexFieldValidationResults(a),r===!0?n.importIndexFieldDocument(n.documentFilename,n.contentType,n.contentTypeDescription,n.fieldValuesForImport,n._params.onImportCompleted,n._params.onError):n._params.onError(Atalasoft.Controls.Capture.Errors.fieldValidationError,n.customValidationCollection)):(a=n.__getFieldListValuesForImport(void 0,n.batchFieldArray),r=n.__checkIndexFieldValidationResults(a),r===!0?n.importLoosePageDocument(n.documentFilename,n.contentType,n.fieldValuesForImport,n._params.onImportCompleted,n._params.onError):n._params.onError(Atalasoft.Controls.Capture.Errors.indexFieldValidationError,n.customValidationCollection))}),e(".atala-track-import-button").click(function(){n.trackImportStatus(n.currentImportId,n._params.onTrackStatusReceived)})},function(e,t){n._params.onError(e,{statusText:t.xhr.statusText+(-1!=t.xhr.responseText.indexOf("LicenseException")?" - Licensing":"")})});else{void 0!==e(".atala-content-type-list")[0]&&e(".atala-content-type-list").change(function(){n.contentType=e(".atala-content-type-list option:selected").text(),n.__getContentTypeDocs(n.contentType)}),void 0!==e(".atala-content-type-document-list")[0]&&e(".atala-content-type-document-list").change(function(){n.contentTypeDescription=n.contentTypeDescriptionArray[n.contentType],n.__getIndexAndBatchFields(n.contentType,n.contentTypeDescription)}),void 0!==n._params.contentType&&void 0!==n._params.contentTypeDescriptionName&&n.__getContentTypeDocsWithNoUI(n._params.contentType,n._params.contentTypeDescriptionName),void 0!==n._params.contentType&&n.__getContentTypeDocs(n._params.contentType);var o=[];void 0!==e(".atala-indexfield-list")[0]&&void 0!==n._params.contentType?void 0!==n._params.contentTypeDescriptionName?(o.documentClass=n._params.contentTypeDescriptionName,n.__getIndexAndBatchFields(n._params.contentType,o)):n.__getIndexAndBatchFields(n._params.contentType,void 0):(void 0!==n._params.contentTypeDescriptionName&&(o.documentClass=n._params.contentTypeDescriptionName,void 0!==n._params.indexFields&&n.__setIndexFieldsWithNoUi(n._params.indexFields)),void 0!==n._params.batchFields&&n.__setBatchFieldsWithNoUi(n._params.batchFields)),e(".atala-import-button").click(function(){n.importDocument(n.documentFilename,n._params.contentType,n.contentTypeDescription,n._params.onImportCompleted,n._params.onError)}),e(".atala-import-index-field-button").click(function(){var t=!1;if(void 0===e(".atala-indexfield-list")[0]?void 0!==n._params.indexFields?n.__setIndexFieldsWithNoUi(n._params.indexFields):void 0!==n._params.batchFields&&n.__setBatchFieldsWithNoUi(n._params.batchFields):void 0!==n._params.contentTypeDescriptionName?(a=n.__getIndexFieldListValuesForImport(n.indexFieldsForDocumentClassArray),t=!0):a=n.__getIndexFieldListValuesForImport(n.batchFieldArray),r=void 0!==e(".atala-indexfield-list")[0]?n.__checkIndexFieldValidationResults(a):!0,r===!0)if(void 0!==n._params.contentTypeDescriptionName){var o=[];o.documentClass=n._params.contentTypeDescriptionName,n.importIndexFieldDocument(n.documentFilename,n._params.contentType,o,n.fieldValuesForImport,n._params.onImportCompleted,n._params.onError)}else n.importLoosePageDocument(n.documentFilename,n._params.contentType,n.fieldValuesForImport,n._params.onImportCompleted,n._params.onError);else t===!0?n._params.onIndexFieldImportValidationError(Atalasoft.Controls.Capture.Errors.indexFieldValidationError,a):n._params.onBatchFieldImportValidationError(Atalasoft.Controls.Capture.Errors.batchFieldValidationError,a)}),e(".atala-track-import-button, .atala-import-button").click(function(){n.trackImportStatus(n.currentImportId,n._params.onTrackStatusReceived)})}},dispose:function(){e(".atala-content-type-list, .atala-content-type-document-list").each(function(t,n){e(n).empty().off("change")}),e(".atala-import-index-field-button, .atala-track-import-button").each(function(t,n){e(n).off("click")}),e(".atala-batchfield-list, .atala-indexfield-list").each(function(t,n){e(n).empty()}),this.__resetFields()},setBatchFieldValues:function(e){var t=this;e.length>0&&void 0!==e&&t.__setBatchFieldsWithNoUi(e)},setIndexFieldValues:function(e){var t=this;e.length>0&&void 0!==e&&t.__setIndexFieldsWithNoUi(e)},importDocument:function(t,n,a,r,o){var i,s=this,l="";void 0!==a&&(l=a.documentClass),s.__beforeImporting(s)&&(i={url:this._params.handlerUrl+"?cmd=importDocument",type:"POST",data:{filename:t,contentType:n,contentTypeDocumentClass:l,contentTypeDescription:JSON.stringify(a)},dataType:"json",success:function(e,t){"true"===e.success?(r(e,e.id,e.status,t),s.__setCurrentImportId(e.id)):o(e.errorMessage,t)},error:function(e){o(Atalasoft.Controls.Capture.Errors.importError,{xhr:e})}},e.ajax(i))},importIndexFieldDocument:function(t,n,a,r,o,i){var s=this;if(s.__beforeImporting(s)){var l={url:this._params.handlerUrl+"?cmd=importDocumentWithIndexFields",type:"POST",data:{filename:t,contentType:n,contentTypeDocumentClass:a.documentClass,contentTypeDescription:JSON.stringify(a),indexFields:JSON.stringify(r)},dataType:"json",success:function(e,t){"true"===e.success?(o(e,e.id,e.status,t),s.__setCurrentImportId(e.id)):i(e.errorMessage,t)},error:function(e){i(Atalasoft.Controls.Capture.Errors.importError,{xhr:e})}};e.ajax(l)}},importLoosePageDocument:function(t,n,a,r,o){var i=this;if(i.__beforeImporting(i)){var s={url:this._params.handlerUrl+"?cmd=importDocumentWithIndexFields",type:"POST",data:{filename:t,contentType:n,indexFields:JSON.stringify(a)},dataType:"json",success:function(e,t){"true"===e.success?(r(e,e.id,e.status,t),i.__setCurrentImportId(e.id)):o(e.errorMessage,t)},error:function(e){o(Atalasoft.Controls.Capture.Errors.importError,{xhr:e})}};e.ajax(s)}},trackImportStatus:function(t,n){e.get(this._params.handlerUrl+"?cmd=trackImportStatus&importId="+encodeURIComponent(t),{},function(e){n(e.status)})},getContentTypeList:function(t,n){e.getJSON(this._params.handlerUrl+"?cmd=getContentTypeList",{},function(e){t(e)}).fail(function(e){n(Atalasoft.Controls.Capture.Errors.contentTypesError,{xhr:e})})},getContentTypeDescription:function(t,n,a){e.getJSON(this._params.handlerUrl+"?cmd=getContentTypeDescription&contentType="+t,{},function(e){n(e)}).fail(function(e){a(Atalasoft.Controls.Capture.Errors.contentDescError,{xhr:e})})},getIndexFieldsForDocumentClass:function(t,n,a,r){e.getJSON(this._params.handlerUrl+"?cmd=indexFieldsForDocumentClass&contentType="+t+"&documentClass="+n,{},function(e){a(e)}).error(function(e){r(Atalasoft.Controls.Capture.Errors.docClassIndexFieldError,{xhr:e})})},getBatchFields:function(t,n,a){e.getJSON(this._params.handlerUrl+"?cmd=getBatchFields&contentType="+t,{},function(e){n(e)}).error(function(e){a(Atalasoft.Controls.Capture.Errors.batchFieldsError,{xhr:e})})}}}(jQuery),function(){function e(e,t){for(var n=0;3>n;n++)if(e[n]!=t[n])return e[n]<t[n];return!1}var t=[1,7,1];if("undefined"==typeof jQuery||e(jQuery().jquery.split("."),t))throw"jQuery "+t.join(".")+" or greater is required."}();var Atalasoft=jQuery.extend(!0,{},Atalasoft,{Controls:{Capture:{}},Utils:{}});!function(e){Atalasoft.Utils.getScriptBaseDir=function(e){var t=document.getElementsByTagName("script");for(var n in t){var a=t[n].src;if(a){var r=a.indexOf(e);if(-1!=r)return a.substring(0,r)}}throw e+" must be included in the <head> as a script tag."},Atalasoft.Utils.versionLess=function(e,t){return e[0]!=t[0]?e[0]<t[0]:e[1]!=t[1]?e[1]<t[1]:e[2]!=t[2]?e[2]<t[2]:e[3]<t[3]};try{Atalasoft.Controls.Capture.scriptBaseDir=Atalasoft.Utils.getScriptBaseDir("atalaWebCapture.min.js")}catch(t){}try{Atalasoft.Controls.Capture.scriptBaseDir=Atalasoft.Utils.getScriptBaseDir("atalaWebCapture.js")}catch(t){}if(!Atalasoft.Controls.Capture.concatenated){Atalasoft.Utils.getScript=function(t,n){e("head").append('<script type="text/javascript" src="'+t+n+'"></script>')};try{Atalasoft.Utils.getScript(Atalasoft.Controls.Capture.scriptBaseDir,"atalaCaptureService.js")}catch(t){}try{Atalasoft.Utils.getScript(Atalasoft.Controls.Capture.scriptBaseDir,"atalaLogger.js")}catch(t){}try{Atalasoft.Utils.getScript(Atalasoft.Controls.Capture.scriptBaseDir,"atalaWebTwain.js")}catch(t){}try{Atalasoft.Utils.getScript(Atalasoft.Controls.Capture.scriptBaseDir,"atalaWebTwain.Service.js")}catch(t){}try{Atalasoft.Utils.getScript(Atalasoft.Controls.Capture.scriptBaseDir,"atalaWebTwain.Image.js")}catch(t){}try{Atalasoft.Utils.getScript(Atalasoft.Controls.Capture.scriptBaseDir,"atalaWebTwain.File.js")}catch(t){}try{Atalasoft.Utils.getScript(Atalasoft.Controls.Capture.scriptBaseDir,"atalaWebTwain.Scan.js")}catch(t){}try{Atalasoft.Utils.getScript(Atalasoft.Controls.Capture.scriptBaseDir,"atalaWebTwain.Thumb.js")}catch(t){}try{Atalasoft.Utils.getScript(Atalasoft.Controls.Capture.scriptBaseDir,"atalaEzTwain.js")}catch(t){}try{Atalasoft.Utils.getScript(Atalasoft.Controls.Capture.scriptBaseDir,"atalaUpload.js")}catch(t){}}Atalasoft.Controls.Capture.Errors={report:function(t,n,a){t?t(n,a):e.error(n)},activeX:"The Scanning ActiveX Control needs to be installed, updated, or enabled, or ActiveX controls need to be allowed to install and run.",ajax:"Could not create an XMLHttpRequest object needed for uploading.",badBrowser:"Scanning requires Chrome, FireFox, or Internet Explorer (at least version 8 and with Compatibility View Mode disabled) running on Windows.",badLicense:"Scanning service license is invalid or expired.",badVrsLicense:"VRS license is missing or invalid.",vrsBadCommand:"eVRS command string is invalid",batchFieldValidationError:"Batch field validation failed.",batchFieldsError:"The server could not retrieve the batch fields for the selected batch class.",contentTypesError:"The server could not retrieve content types.",contentDescError:"The server could not retrieve the content description.",dllVersion:"Scanning service helper DLL is an incompatible version",docClassIndexFieldError:"The server could not retrieve the index fields for the document class.",doorOpen:"Scanner reports cover open",doubleFeed:"Scanner reports a double-feed",driverCrash:"Fatal exception in scanner driver",dsmFail:"Failure in TWAIN Manager",dsOpen:"Failed to open scanner",fieldValidationError:"Batch, or index field validation failed.",fileFail:"File not found or cannot be written or cannot be read.",fileLocked:"File locked by other application.",helperDll:"Failed to load scanning service helper DLL",importError:"The server could not import the document.",indexFieldValidationError:"IndexField validation failed.",internalError:"Unexpected internal error",licensingError:"Scanning service: The server did not return valid licensing information",noPlugin:"The scanning service needs to be installed. If it is installed it may need to be enabled. In the browser look for Add-ons, Plugins, Kofax scanning.",noTwain:"The TWAIN Manager needs to be installed.",oldPlugin:"The scanning service needs to be updated to a newer version.",outOfMemory:"Insufficient memory to complete an operation. Restarting the browser may help.",paperJam:"Scanner reports a paper jam.",pluginCreate:"Scanning service not created",scanFail:"Unable to start scan",serverNotResponding:"The server is not responding.",tooManyImages:"Too many images for Scanning service to handle.",unsupportedFormatWarning:"Warning: Only the following image file types are supported for import: BMP, GIF, JPG/JPEG, PDF, TIFF. All other file types will be ignored and will not be imported.",uploadError:"The server reported an error while uploading.",userCancel:"User cancelled the operation.",vrsBadDpiWarning:"Warning: One or more images were skipped - Image Enhancement requires image DPI > 25",xferFail:"Image transfer from scanner failed.",webServiceMissed:"Web Capture local service is not running.",lowIntegrityAccessDenied:"Access to the Web Capture Service is denied because the current user has insufficient rights. This can have happened if you have visited site with the untrusted certificate or connect to the Web Capture Service from internet. Contact your administrator for assistance.",oldWindowsService:"The scanning service needs to be updated to a newer version. Contact your administrator for assistance.",brokenConnection:"Connection to the scanning service is broken. You may need to refresh the page to restore it."},Atalasoft.Controls.Capture.PixelType={Auto:-2,Any:-1,BW:0,Grayscale:1,Color:2,Indexed:3},Atalasoft.Controls.Capture.ImprinterTypes={ImprinterBefore:"ImprinterBefore",ImprinterAfter:"ImprinterAfter",ImprinterBottomBefore:"ImprinterBottomBefore",ImprinterBottomAfter:"ImprinterBottomAfter",EndorserBefore:"EndorserBefore",EndorserAfter:"EndorserAfter",EndorserBottomBefore:"EndorserBottomBefore",EndorserBottomAfter:"EndorserBottomAfter"},Atalasoft.Controls.Capture.WebScanning={_params:{},scanningOptions:{},uploadOptions:{},isSupportedBrowser:!1,logger:Atalasoft.Logger,initialize:function(t){if(this.logger.log("Atalasoft.Controls.Capture.WebScanning.initialize(...)"),this._params=t,void 0!==t.scanningOptions&&(this.scanningOptions=t.scanningOptions),void 0!==t.uploadOptions&&(this.uploadOptions=t.uploadOptions),this._localizeErrors(Atalasoft.Controls.Capture.Errors,t.localization),!this._scanClient){this._scanClient=Atalasoft.Controls.Capture.EZTwainScanner.getScanClient(),this._scanClient.initialize({onScanError:t.onScanError,onScanStarted:t.onScanStarted,onScanCompleted:t.onScanCompleted,onImageAcquired:t.onImageAcquired,onScanClientReady:function(){Atalasoft.Controls.Capture.WebScanning.__onScanClientReady()},eventBindObject:this.__eventBindObject(),localization:Atalasoft.Controls.Capture.Errors,scanningOptions:this.scanningOptions});var n=this,a=function(){if(n._scanClient){if(n._scanClient.abortScan(),n._params.onShutdown)try{n._params.onShutdown()}catch(e){}n._scanClient.__shutdown()}};n.destuructor=a,e(window).bind("beforeunload",a).bind("unload",a)}Atalasoft.Controls.Capture.UploadToCaptureServer.initialize({handlerUrl:t.handlerUrl,serverTimeout:t.serverTimeout,onUploadError:t.onUploadError,onUploadStarted:t.onUploadStarted,onUploadCompleted:t.onUploadCompleted,uploadLocation:t.uploadLocation,eventBindObject:this.__eventBindObject(),uploadOptions:this.uploadOptions})},dispose:function(t,n){var a=this;Atalasoft.Controls.Capture.UploadToCaptureServer.dispose(),a._scanClient&&a._scanClient.__shutdown(function(){a._scanClient=null,a.destuructor&&(e(window).unbind("beforeunload",a.destuructor).unbind("unload",a.destuructor),a.destuructor=null),a.__disconnectUI(),t&&t()},function(){a.__disconnectUI(),n&&"function"==typeof n&&n.apply(a,arguments)})},isInitialized:function(){return!!this._scanClient},scan:function(e){void 0===e&&(e=this.scanningOptions),this._scanClient.scan(e,Atalasoft.Controls.Capture.UploadToCaptureServer.getUploadCallback())},abortScan:function(){this._scanClient.abortScan()},importFiles:function(e){void 0===e&&(e=this.scanningOptions),this._scanClient.importFiles(e)},showSettingsDialog:function(e,t){e||(e=this.scanningOptions),this._scanClient.showSettingsDialog(e,t)},getSupportedValues:function(e,t){e||(e=this.scanningOptions),this._scanClient.getSupportedValues(e,t)},getCurrentValues:function(e,t){e||(e=this.scanningOptions),this._scanClient.getCurrentValues(e,t)},setSymmetricEncryptionKey:function(e){this.logger.deprecate("Atalasoft.Controls.Capture.WebScanning.setSymmetricEncryptionKey","Atalasoft.Controls.Capture.WebScanning.LocalFile.setEncryptionKey"),this._scanClient.setSymmetricEncryptionKey(e)},saveBase64ToEncryptedLocalFile:function(e){return this.logger.deprecate("Atalasoft.Controls.Capture.WebScanning.saveBase64ToEncryptedLocalFile","Atalasoft.Controls.Capture.WebScanning.LocalFile.fromBase64String"),this._scanClient.saveBase64ToEncryptedLocalFile(e)},encryptedLocalFileAsBase64String:function(e,t,n){return this.logger.deprecate("Atalasoft.Controls.Capture.WebScanning.encryptedLocalFileAsBase64String","Atalasoft.Controls.Capture.WebScanning.LocalFile.asBase64String"),this._scanClient.encryptedLocalFileAsBase64String(e,t,n)},deleteLocalFile:function(e){this.logger.deprecate("Atalasoft.Controls.Capture.WebScanning.deleteLocalFile","Atalasoft.Controls.Capture.WebScanning.LocalFile.remove"),this._scanClient.deleteLocalFile(e)},listLocalFiles:function(){return this.logger.deprecate("Atalasoft.Controls.Capture.WebScanning.listLocalFiles","Atalasoft.Controls.Capture.WebScanning.LocalFile.list"),this._scanClient.listLocalFiles()},setBarcodeLicense:function(e){this._scanClient.setBarcodeLicense(e)},getProfile:function(e){return void 0===e&&(e=this.scanningOptions),this.__stringify(e)},setProfile:function(t){this.scanningOptions=e.parseJSON(t)},getVersion:function(){return this._scanClient.getVersion()},getScanStationName:function(){return this.isInitialized()&&this._scanClient?this._scanClient.getScanStationName():void 0},_localizeErrors:function(e,t){if(t)for(var n in e)"string"==typeof e[n]&&n in t&&(e[n]=t[n])},__getLicense:function(){var t=this;e.getJSON(this._params.handlerUrl+"?cmd=getLicense",{},function(e){t.__gotLicense(e)}).fail(function(e){Atalasoft.Controls.Capture.Errors.report(t._params.onScanError,Atalasoft.Controls.Capture.Errors.licensingError,e)})},__gotLicense:function(e){var t=this;this._scanClient.setLicense(e,function(){t._scanClient.enumerateScanners(function(){t.__connectGui(),t._params.onScanClientReady&&t._scanClient!==Atalasoft.Controls.Capture.NullScanner&&t._params.onScanClientReady()})})},__onScanClientReady:function(){this.isSupportedBrowser=this._scanClient.isSupportedBrowser,this.isSupportedBrowser&&(this.LocalFile={_scanClient:this._scanClient,setEncryptionKey:function(e,t){this._scanClient.setSymmetricEncryptionKey(e,t)},fromBase64String:function(e,t){return this._scanClient.saveBase64ToEncryptedLocalFile(e,t)},asBase64String:function(){return this._scanClient.encryptedLocalFileAsBase64String.apply(this._scanClient,arguments)},splitToFiles:function(){return this._scanClient.splitToFiles.apply(this._scanClient,arguments)},remove:function(e,t){this._scanClient.deleteLocalFile(e,t)},list:function(e){return this._scanClient.listLocalFiles(e)},removeAll:function(e){this._scanClient.removeAll(e)},globalPurgeByAge:function(e,t){this._scanClient.globalPurgeByAge(e,t)}}),this._params.license?(this.__gotLicense(this._params.license),delete this._params.license):this.isSupportedBrowser&&this.__getLicense()},__eventBindObject:function(){return e("body")},__connectGui:function(){this.__connectScanButtons(this._scanClient.scanners,e(".atala-scan-button")),this.__connectImportButtons(e(".atala-local-file-import-button")),this.__connectScannerListElement(this._scanClient.scanners,this._scanClient.defaultScanner,e(".atala-scanner-list"))},__disconnectUI:function(){e(".atala-scan-button, .atala-local-file-import-button").each(function(t,n){e(n).off("click").attr("disabled",!0)}),e(".atala-scanner-list").each(function(t,n){e(this).attr("disabled",!0).empty(),n.onchange=null})},__connectScanButtons:function(e,t){e.length>0?(t.click(function(){Atalasoft.Controls.Capture.WebScanning.scan()}),t.removeAttr("disabled")):t.attr("disabled",!0)},__connectScannerListElement:function(e,t,n){var a=this;if(n.length>0){var r=n[0];if(r.length=0,e.length>0){for(var o=0;o<e.length;o++){var i=document.createElement("option");i.text=e[o],i.value=e[o],r.add(i),i.text===t&&(r.selectedIndex=r.length-1)}r.onchange=function(){a._scanClient.onScannerSelected(r.options[r.selectedIndex].value)},n.removeAttr("disabled")}else n.attr("disabled",!0)}else this._scanClient.onScannerSelected(t)},__connectImportButtons:function(e){e.click(function(){Atalasoft.Controls.Capture.WebScanning.importFiles()}),e.removeAttr("disabled")},__stringify:function(e){var t=typeof e;if("object"!==t||null===e)return"string"===t&&(e='"'+e+'"'),String(e);var n,a,r=[],o=e&&e.constructor===Array;for(n in e)if(e.hasOwnProperty(n)){if(a=e[n],t=typeof a,"string"===t)a='"'+a+'"';else if("object"===t&&null!==a)a=this.__stringify(a);else if("function"===t)continue;r.push((o?"":'"'+n+'":')+String(a))}return(o?"[":"{")+String(r)+(o?"]":"}")}}}(jQuery),Atalasoft.Controls.Capture.NullScanner={abortScan:function(){},deleteLocalFile:function(){},encryptedLocalFileAsBase64String:function(){return null},getSupportedValues:function(e,t){t(null)},getCurrentValues:function(e,t){t(null)},globalPurgeByAge:function(){},importFiles:function(){},initialize:function(e){e.onScanClientReady&&e.onScanClientReady(),Atalasoft.Controls.Capture.Errors.report(e.onScanError,Atalasoft.Controls.Capture.Errors.badBrowser,this._badBrowser)
},isInstalled:function(){return!0},isAppropriateForClient:function(){return!0},listLocalFiles:function(){return null},removeAll:function(){},saveBase64ToEncryptedLocalFile:function(){return null},scan:function(){},setBarcodeLicense:function(){},setLicense:function(){return!1},setSymmetricEncryptionKey:function(){},getVersion:function(){return Atalasoft.Controls.Capture.minVersion},getScanStationName:function(){return void 0},showSettingsDialog:function(e,t){t({complete:!1})},__shutdown:function(){},scanners:[],defaultScanner:"",isSupportedBrowser:!1,onScannerSelected:function(){},_badBrowser:""},Atalasoft.Controls.Capture.EZTwainScanner={_localization:{notWindows:"Platform is not Windows: ",ieVersion:"IE version not supported: ",notSupported:"Not currently supported: ",pluginVersion:"Plugin is version: ",minVersionNeeded:"minimum version needed: "},getScanClient:function(){if("Win"!==navigator.platform.substring(0,3))return Atalasoft.Controls.Capture.NullScanner._badBrowser=this._localization.notWindows+navigator.platform,Atalasoft.Controls.Capture.NullScanner;var e=this.__detectBrowser();return e.msie&&e.version<8?(Atalasoft.Controls.Capture.NullScanner._badBrowser=this._localization.ieVersion+e.version,Atalasoft.Controls.Capture.NullScanner):e.msie||e.firefox||e.chrome?(Atalasoft.Controls.Capture.WebTwainScanner._browser=e,Atalasoft.Controls.Capture.WebTwainScanner):(Atalasoft.Controls.Capture.NullScanner._badBrowser=this._localization.notSupported+(e.name||navigator.userAgent),Atalasoft.Controls.Capture.NullScanner)},__detectBrowser:function(){function e(e){var t=n.match(e);return t&&t.length>1&&t[1]||""}var t={name:""},n=navigator.userAgent||"";return/Opera\W|\sOPR\W/.test(n)?t={name:"Opera",opera:!0,version:parseFloat(e(/(?:.*Version\W|Opera\W|\sOPR\W)(\d+\.\d+)/))}:/msie|trident/i.test(n)?t={name:"Internet Explorer",msie:!0,version:parseFloat(e(/(?:msie |rv:)(\d+\.\d+)/i))}:/chrome/i.test(n)?t={name:"Chrome",chrome:!0,version:parseFloat(e(/(?:chrome|crios|crmo)\/(\d+\.\d+)/i))}:/firefox|iceweasel/i.test(n)?t={name:"Firefox",firefox:!0,version:parseFloat(e(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i))}:/safari/i.test(n)&&(t={name:"Safari",safari:!0,version:parseFloat(e(/Version\W(\d+\.\d+)/i))}),t}},function(e){Atalasoft.Controls.Capture.WebTwain={SessionId:0,HostRunsAsService:!1,ReadyState:1,TwainAvailable:!1,InstalledSources:[],DefaultSourceDevice:"",scanningOptions:{},_shutdown:!1,connectionBroken:!0,eventsUrl:"",settingsUrl:"",images:"",image:"",_sessionsKey:"sessions",initialize:function(e,t,n,a){var r=this;Atalasoft.Logger.scope("WebTwain.initialize()",function(){r._shutdown=!1,r._server=Atalasoft.Controls.Capture.WebTwain.Service,r._server.setLimitedMode(t.msie&&t.version<10);var o={localization:e.localization,scanningOptions:Atalasoft.Controls.Capture.WebTwainScanner.__extendScanningOptions(e.scanningOptions)};r.__retryConnection(o,function(e){r.SessionId=e.id,r.HostRunsAsService=e.hostRunsAsService,r.self=e.self,r.eventsUrl=e.events,r.settingsUrl=e.settings,r.images=e.images,r.Scan=new Atalasoft.Controls.Capture.WebTwain.ScanApi(e),r.LocalFile=new Atalasoft.Controls.Capture.WebTwain.LocalFileApi(e),r.scanningOptions=Atalasoft.Controls.Capture.WebTwainScanner.__extendScanningOptions(e.scanningOptions),r.ReadyState=e.readyState||1,r.TwainAvailable=e.twainAvailable,r.AppTitle=e.appTitle,r.Localization=e.localization,r.FullVersion=JSON.parse("["+e.fullVersion.split(".").join(",")+"]"),r.machineName=e.machineName,r.connectionBroken=!1,r.closeAbandonedSessions(function(){n&&n.call&&n.call(r)})},a)})},closeAbandonedSessions:function(e){var t=this,n={future:null},a=function(e,t){return function(){n.future=e.shutdownWorker(t)}};if(t._server.isLimitedMode()&&window.localStorage){var r=window.localStorage.getItem(t._sessionsKey);if(r){r=JSON.parse(r);for(var o=0;o<r.length;++o){var i=r[o];i&&(n.future?n.future.always(a(t,i)):n.future=t.shutdownWorker(i))}}}n.future?n.future.always(function(){window.localStorage.removeItem(t._sessionsKey),e()}):e()},reloadScanners:function(e,t){var n=this;this._server.get(this.self,{},e).done(function(e){n.InstalledSources=e.installedSources||[],n.DefaultSourceDevice=e.defaultSourceDevice,n.SourceDevice=e.sourceDevice,t&&t()})},shutdown:function(e,t){var n=this,a=n._sessionsKey;Atalasoft.Logger.scope("WebTwain.shutdown()",function(){if(n.self){if(n.shutdownWorker(n.self).done(function(){n._shutdown=!0,n.self=void 0,n.settingsUrl=void 0,n.eventsUrl=void 0,n.images=void 0,n.SessionId=null,n.Scan.uninitialize(),n.onacquiredone=function(){},n.onacquirefailed=function(){},n.onimageacquired=function(){},n.onscanerror=function(){},n._server.releaseDeffered(),e&&e()}).fail(function(e,n,a){Atalasoft.Logger.warn("WebTwain.shutdown() error "+n+"; "+a),t&&t(Atalasoft.Controls.Capture.Errors.internalError,{})}),n._server.isLimitedMode()&&window.localStorage){var r=window.localStorage.getItem(a)||"[]";r=JSON.parse(r),r.push(n.self),window.localStorage.setItem(a,JSON.stringify(r))}}else n._shutdown=!0})},shutdownWorker:function(e){var t=this,n=null;return Atalasoft.Logger.scope("WebTwain.shutdownWorker: "+e,function(){n=t._server.del(e,{},!1)}),n},updateSettings:function(e,t){return this._server.put(this.self,e,t)},AsBase64String:function(e,t,n){var a=this,r="";return Atalasoft.Logger.scope("WebTwain.Clear()",function(){a._server&&a.images&&a._server.get(a.images,{format:e,jpegCompression:t?t.jpegCompression:void 0,quality:t?t.quality:void 0},"function"==typeof n).done(function(e){r=e.base64||"",n&&"function"==typeof n&&n(r)}).fail(function(e,t,n){Atalasoft.Logger.log("WebTwain.AsBase64String() error "+t+"; "+n)})}),r},Clear:function(){var e=this;Atalasoft.Logger.scope("WebTwain.Clear()",function(){e._server&&e.images&&e._server.del(e.images)})},DeleteImage:function(e){Atalasoft.Logger.scope("WebTwain.DeleteImage()",function(){e&&e.clear&&e.clear()})},onacquiredone:function(){},onacquirefailed:function(){},onimageacquired:function(){},onscanerror:function(){},startEventsPoll:function(){var e={AcquireDone:0,AcquireFailed:1,ImageAcquired:2,ScanError:3,SuportedValues:4,ScanDialogComplete:5,SessionDisposed:6,CurrentValues:7},t=this,n=0;this._server.poll(this.eventsUrl,function(a){switch(t.connectionBroken=!1,n=0,a.eventType){case e.AcquireDone:t.onacquiredone();break;case e.AcquireFailed:t.onacquirefailed(a.message,a.details);break;case e.ImageAcquired:var r=new Atalasoft.Controls.Capture.WebTwain.Image(a.image.sessionId,a.image.index,a.image);t.onimageacquired(a.index,r);break;case e.ScanError:t.onscanerror(a.message,a.details);break;case e.SuportedValues:t._server.executeDeferredCallback(a.callbackId,a.values);break;case e.ScanDialogComplete:t._server.executeDeferredCallback(a.callbackId,a.complete);break;case e.SessionDisposed:return!1;case e.CurrentValues:t._server.executeDeferredCallback(a.callbackId,a.values)}return!t._shutdown},function(e){if(e){if(404===e.status)return t.reportBrokenConnection(Atalasoft.Controls.Capture.Errors.brokenConnection),!1;if((500===e.status||0===e.status)&&!t._shutdown&&++n>15)return t.reportBrokenConnection(),n=0,!1}return!t._shutdown})},reportBrokenConnection:function(e){var t=this;t.connectionBroken||(t.connectionBroken=!0,e?Atalasoft.Controls.Capture.WebTwainScanner.__reportError(e):Atalasoft.Controls.Capture.WebTwainScanner.__reportError(Atalasoft.Controls.Capture.Errors.noPlugin,{message:Atalasoft.Controls.Capture.Errors.webServiceMissed,filename:Atalasoft.Controls.Capture.WebTwainScanner._installerFileName}))},__serviceUrlBase:"https:"===window.location.protocol?"https://127.0.0.1:23024":"http://127.0.0.1:23023",__retryConnection:function(e,t,n){var a=2e3,r=this;r._shutdown||this._server.post(this.__serviceUrlBase+"/sessions",e,!0).done(function(e){t.call(r,e)}).fail(function(o){n&&n(o),window.setTimeout(function(){r.__retryConnection(e,t)},a)})}},Atalasoft.Controls.Capture.WebTwainScanner={scanners:[],defaultScanner:"",isSupportedBrowser:!0,_logger:Atalasoft.Logger,_installerFileName:"Kofax.WebCapture.Installer.msi",_eztwain:{},_params:{},_lastSheetNo:-1,_aborting:!1,_localization:{not32Bit:"Browser is not 32-bit: ",notWindows:"Platform is not Windows: ",ieVersion:"IE version not supported: ",notSupported:"Not currently supported: ",pluginVersion:"Plugin is version: ",minVersionNeeded:"minimum version needed: "},__reportError:function(e,t){Atalasoft.Controls.Capture.Errors.report(this._params.onScanError,e,t)},getVersion:function(){return this._eztwain.FullVersion},getScanStationName:function(){return this._eztwain.machineName},deleteLocalFile:function(e,t){var n=this._eztwain.LocalFile;"function"==typeof t?n.removeAsync(e,t):n.remove(e)},encryptedLocalFileAsBase64String:function(){var e=Array.prototype.slice.call(arguments),t=e.slice(-1).pop(),n=this._eztwain.LocalFile;return"function"!=typeof t?n.asBase64String.apply(n,arguments):(e.unshift(e.pop()),n.asBase64StringAsync.apply(n,e),void 0)},splitToFiles:function(){var e=Array.prototype.slice.call(arguments),t=this._eztwain.LocalFile;e.unshift(e.pop()),t.splitToFiles.apply(t,e)},globalPurgeByAge:function(e,t){var n=this._eztwain.LocalFile;"function"==typeof t?n.globalPurgeByAgeAsync(e,t):n.globalPurgeByAge(e)},listLocalFiles:function(e){var t=this._eztwain.LocalFile;return"function"!=typeof e?t.list():(t.listAsync(e),void 0)},removeAll:function(e){var t=this._eztwain.LocalFile;"function"==typeof e?t.removeAllAsync(e):t.removeAll()},saveBase64ToEncryptedLocalFile:function(e,t){var n=this._eztwain.LocalFile;return"function"!=typeof t?n.fromBase64String(e):(n.fromBase64StringAsync(e,t),void 0)},setBarcodeLicense:function(e){var t={barcodeLicense:e},n=this;this._eztwain.updateSettings(t,!0).fail(function(e,t,a){n._logger.error("setBarcodeLicense() failed: "+t+"; "+a),n.__reportError(Atalasoft.Controls.Capture.Errors.internalError)})},setLicense:function(e,t){var n=this;if(e&&(e.key||e.barcode)){var a={domain:window.location.hostname};e.key&&(a.wingScanLicense=e.key),e.barcode&&(a.barcodeLicense=e.barcode),this._eztwain.updateSettings(a,!0).done(function(){t&&t(!0)}).fail(function(e,a,r){n._logger.error("setLicense() failed: "+a+"; "+r),t?t(!1):n.__reportError(Atalasoft.Controls.Capture.Errors.internalError,{})})}return!0},setSymmetricEncryptionKey:function(e){var t=Array.prototype.slice.call(arguments),n=t.slice(-1).pop(),a="function"==typeof n,r=this;r._eztwain.updateSettings({symmetricEncryptionKey:e},a).done(n).fail(function(e,t,n){r._logger.error("setSymmetricEncryptionKey() failed: "+t+"; "+n),r.__reportError(Atalasoft.Controls.Capture.Errors.internalError,{})})},enumerateScanners:function(){var t=Array.prototype.slice.call(arguments),n=t.slice(-1).pop(),a="function"==typeof n,r=e.Deferred(),o=this;this._eztwain.TwainAvailable?this._eztwain.reloadScanners(a,function(){o.scanners=o._eztwain.InstalledSources||[],o.defaultScanner=o._eztwain.DefaultSourceDevice,r.resolve()}):(this.__reportError(Atalasoft.Controls.Capture.Errors.noTwain),r.resolve()),r.done(function(){a&&n()})},onScannerSelected:function(e){this._eztwain.SourceDevice=e},isInstalled:function(){return!0},__bindEvents:function(e){var t=this._params.eventBindObject,n=e?t.bind:t.unbind;this._params.onScanStarted&&n.call(t,"onScanStarted",e?{}:this._params.onScanStarted,this._params.onScanStarted),this._params.onScanCompleted&&n.call(t,"onScanCompleted",e?{}:this._params.onScanCompleted,this._params.onScanCompleted),this._params.onImageAcquired&&n.call(t,"onImageAcquired",e?{}:this._params.onImageAcquired,this._params.onImageAcquired),this._params.onScanError&&n.call(t,"onScanError",e?{}:this._params.onScanError,this._params.onScanError)},__pluginTooOld:function(e,t){return Atalasoft.Utils.versionLess(e.FullVersion,t)},__extendScanningOptions:function(e){var t={};return e=e||{},t.scanner="string"==typeof e.scanner?e.scanner:this._eztwain.SourceDevice,t.brightness=void 0!==e.brightness?Number(e.brightness):0,t.contrast=void 0!==e.contrast?Number(e.contrast):0,t.threshold=void 0!==e.threshold?Number(e.threshold):-1,t.showScannerUI=e.showScannerUI||!1,t.showProgress=e.showProgress!==!1,t.pixelType=void 0!==e.pixelType?Number(e.pixelType):-1,t.resultPixelType=void 0!==e.resultPixelType?Number(e.resultPixelType):-1,t.duplex=void 0!==e.duplex?Number(e.duplex):0,t.dpi=Number(e.dpi)||200,t.feeder=void 0!==e.feeder?Number(e.feeder):-1,t.paperSize=void 0!==e.paperSize?Number(e.paperSize):3,t.orientation=void 0!==e.orientation?Number(e.orientation):-1,t.applyVRS=void 0!==e.applyVRS?e.applyVRS:!0,t.disableVRSIfInstalledOnWorkstation=e.disableVRSIfInstalledOnWorkstation||!1,t.deskew=void 0!==e.deskew?e.deskew:t.applyVRS,t.autoRotate=void 0!==e.autoRotate?e.autoRotate:t.applyVRS,t.autoCrop=e.autoCrop||!1,t.holeFill=e.holeFill||!1,t.despeckle=e.despeckle||!1,t.discardBlankPages=e.discardBlankPages||!1,t.suppressBackgroundColor=e.suppressBackgroundColor||!1,t.maxPages=Number(e.maxPages)||-1,t.patchCodes=e.patchCodes||!1,t.importEDocs=e.importEDocs||!1,0===t.feeder&&1===t.duplex&&(t.duplex=0),"object"==typeof e.barcodes?(t.barcodes=e.barcodes,t.barcodes.hasOwnProperty("count")||(t.barcodes.count=-1)):t.barcodes={count:0},t.tiff=t.tiff||{jpegCompression:!0},e.tiff&&void 0!==e.tiff.jpegCompression&&(t.tiff.jpegCompression=e.tiff.jpegCompression),t.jpeg=t.jpeg||{},t.jpeg.quality=Number(e.jpeg&&e.jpeg.quality||75),t.evrsSettings="string"==typeof e.evrsSettings?e.evrsSettings:"",t.deliverables="object"==typeof e.deliverables?e.deliverables:{},"object"==typeof e.imageAddress?t.imageAddress=e.imageAddress:delete t.imageAddress,"object"==typeof e.imprintersConfig?t.imprintersConfig=e.imprintersConfig:delete t.imprintersConfig,this._eztwain.scanningOptions&&(this._eztwain.scanningOptions=t),t},__initEztwainWhenReady:function(){var e=Atalasoft.Controls.Capture.minVersion;if(this._eztwain&&4==this._eztwain.ReadyState)if(this.__pluginTooOld(this._eztwain,e)){var t=this._localization.pluginVersion+this._eztwain.FullVersion+" - "+this._localization.minVersionNeeded+e;this._eztwain.HostRunsAsService?this.__reportError(Atalasoft.Controls.Capture.Errors.oldWindowsService,{message:t}):this.__reportError(Atalasoft.Controls.Capture.Errors.oldPlugin,{message:t,filename:this._installerFileName})}else{this.__bindEvents(!0);var n=this;n._eztwain.onacquiredone=function(){n.__onAcquireDone()},n._eztwain.onacquirefailed=function(e,t){n.__onAcquireFailed(e,t)},n._eztwain.onimageacquired=function(e,t){n.__onImageAcquired(t)},n._eztwain.onscanerror=function(e,t){n.__reportError(e,{message:t})},n._eztwain.startEventsPoll(n._eztwain.SessionId),n._logger.info("minVer:                 "+e).info("navigator.userAgent:    "+navigator.userAgent).info("navigator.vendor:       "+navigator.vendor).info("browser: "+n._browser.name).info("version: "+n._browser.version),n._params.onScanClientReady&&n._params.onScanClientReady()}else{var a=this;setTimeout(function(){a.__initEztwainWhenReady()},2e3)}},initialize:function(t){this._params=t,t.localization&&e.extend(this._localization,t.localization);var n=this;this._eztwain=Atalasoft.Controls.Capture.WebTwain,this._eztwain.initialize(t,this._browser,function(){n.__initEztwainWhenReady()},function(e){Atalasoft.Controls.Capture.Errors[e.responseText]?n.__reportError(Atalasoft.Controls.Capture.Errors[e.responseText]):n.__reportError(Atalasoft.Controls.Capture.Errors.noPlugin,{message:Atalasoft.Controls.Capture.Errors.webServiceMissed,filename:n._installerFileName})})},__shutdown:function(e,t){try{var n=this;this._eztwain&&this._eztwain.shutdown(function(){n.__bindEvents(!1),n.scanners=[],n._params={},n._eztwain=null,n._uploadFunction=null,e&&e()},t)}catch(a){t&&t(Atalasoft.Controls.Capture.Errors.internalError,a)}},__onAcquireDone:function(){var e=this;this._logger.scope("onAcquireDone event",function(){e._logger.scope("calling user event handler...",function(){e._params.eventBindObject.trigger("onScanCompleted",{success:!0})}),e._uploadFunction&&e._logger.scope("calling uploadFunction.",function(){e._eztwain.AsBase64String(".tif",{},function(t){t&&t.length&&e._uploadFunction(t)})})})},__onAcquireFailed:function(e,t){var n=this;this._logger.scope("onAcquireFailed event (%s, %s)",e,t,function(){n._logger.scope("calling user event handler...",function(){n._params.eventBindObject.trigger("onScanCompleted",{success:!1,error:{message:e,details:t}})})})},__onImageAcquired:function(e){var t=this;this._logger.scope("onImageAcquired event",function(){t._logger.info("image:").object(e),e.discard=!1;try{t._aborting?e.discard=!0:t._logger.scope("calling user event handler...",function(){t._params.eventBindObject.trigger("onImageAcquired",e)})}catch(n){t.__reportError(Atalasoft.Controls.Capture.Errors.internalError,n),e.discard=!0}e.discard&&t._eztwain.DeleteImage(e)})},scan:function(e,t){if(this._eztwain){this._aborting=!1,this._params.eventBindObject.trigger("onScanStarted",{});try{this._eztwain.Clear(),this._lastSheetNo=-1,this._uploadFunction=t;var n=this.__extendScanningOptions(e);this._eztwain.Scan.start(n)||this._params.eventBindObject.trigger("onScanCompleted",{success:!1,error:{message:Atalasoft.Controls.Capture.Errors.scanFail}})}catch(a){this.__reportError(Atalasoft.Controls.Capture.Errors.internalError,a),this._params.eventBindObject.trigger("onScanCompleted",{success:!1,error:a})}}},abortScan:function(){this._eztwain&&(this._aborting=!0,this._eztwain.Scan&&this._eztwain.Scan.abort&&this._eztwain.Scan.abort())},importFiles:function(e){if(this._eztwain){this._aborting=!1,this._params.eventBindObject.trigger("onScanStarted",{});try{this._eztwain.Clear(),this._lastSheetNo=-1,this._uploadFunction=null;var t=this.__extendScanningOptions(e);this._eztwain.Scan.importFiles(t)||this._params.eventBindObject.trigger("onScanCompleted",{success:!1,error:{message:Atalasoft.Controls.Capture.Errors.scanFail}})}catch(n){this.__reportError(Atalasoft.Controls.Capture.Errors.internalError,n),this._params.eventBindObject.trigger("onScanCompleted",{success:!1,error:n})}}},showSettingsDialog:function(e,t){try{"string"!=typeof e.scanner&&(e.scanner=this._eztwain.SourceDevice),this._eztwain.Scan.showSettingsDialog(e,t)}catch(n){this.__reportError(Atalasoft.Controls.Capture.Errors.internalError,n)}},getSupportedValues:function(e,t){try{this._eztwain.Scan.getSupportedValues?("string"!=typeof e.scanner&&(e.scanner=this._eztwain.SourceDevice),this._eztwain.Scan.getSupportedValues(e,t)):t()}catch(n){this.__reportError(Atalasoft.Controls.Capture.Errors.internalError,n)}},getCurrentValues:function(e,t){try{this._eztwain.Scan.getCurrentValues?("string"!=typeof e.scanner&&(e.scanner=this._eztwain.SourceDevice),this._eztwain.Scan.getCurrentValues(e,t)):t()}catch(n){this.__reportError(Atalasoft.Controls.Capture.Errors.internalError,n)}},clear:function(){this._eztwain.Clear()}}}(jQuery),Atalasoft.Controls.Capture.WebTwain.Service=function(e){"use strict";function t(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:7&n|8).toString(16)})}function n(e,t,n){m.scope(e,t,function(){m.log("Body: ").object(n)})}function a(e){m.log("Setting limited mode: ",e),f=void 0===e?!1:e}function r(){return f}function o(t,a,r){return n("GET",t,a),e.ajax({url:t,cache:!1,data:a,type:"GET",async:(void 0===r?!0:r)||f,global:!1})}function i(t,a,r){return n("POST",t,a),e.ajax({url:t,cache:!1,data:JSON.stringify(a||{}),contentType:"application/json",dataType:"json",type:"POST",async:(void 0===r?!0:r)||f,global:!1})}function s(t,a,r){var o=f?"POST":"PUT",i=f?t+"?debugMethod=PUT":t;return n(o,i,a),e.ajax({url:i,cache:!1,data:JSON.stringify(a||{}),contentType:"application/json",dataType:"json",type:o,async:(void 0===r?!0:r)||f,global:!1})}function l(t,a,r){var o=f?"POST":"DELETE",i=f?t+"?debugMethod=DELETE":t;return n(o,i,a),e.ajax({url:i,cache:!1,data:JSON.stringify(a||{}),type:o,async:r||f,global:!1})}function c(t,n,a){var r=this;e.ajax({url:t,type:"POST",cache:!1,dataType:"text",timeout:3e4,global:!1,success:function(e){e=e?JSON.parse(e):{},n(e)&&r.poll(t,n,a)},error:function(e){a(e)&&setTimeout(function(){r.poll(t,n,a)},1e3)}})}function u(e,n,a,r){var o=t();return a=a||{},a.callbackId=o,e(n,a).done(function(){h[o]=r})}function d(e){if(h[e]){var t=Array.prototype.slice.call(arguments,1);h[e].apply(this,t),delete h[e]}}function p(){h={}}var f=!1,h={},m=Atalasoft.Logger;return{get:o,post:i,put:s,del:l,poll:c,callDeferred:u,executeDeferredCallback:d,releaseDeffered:p,setLimitedMode:a,isLimitedMode:r}}(jQuery),Atalasoft.Controls.Capture.WebTwain.Image=function(e){"use strict";function t(e){return function(t,n,a){e.reject(),i.warn("Status:",n,"Error:",a)}}function n(n,a,r){var o=e.Deferred(),l=this;return i.scope("Image.asBase64String",n,function(){if(i.info("Options:").object(a),l.id&&l.selfUrl){var e={jpegCompression:a?a.jpegCompression:void 0,quality:a?a.quality:void 0,format:n,width:l.width,height:l.height};s.get(l.selfUrl,e,r).done(function(e){l.updateData(e),o.resolve(e.base64)}).fail(t(o))}else i.warn("attempting to call asBase64String on empty object."),o.reject()}),o}function a(n,a,r){var o=e.Deferred(),l=this;return i.scope("Image.saveEncryptedLocal",n,function(){if(i.info("Options:").object(a),l.id&&l.selfUrl){var e={format:n,jpegCompression:a?a.jpegCompression:void 0,quality:a?a.quality:void 0,width:l.width,height:l.height};s.put(l.selfUrl,e,r).done(function(e){l.localFile=e.id,o.resolve(e.id)}).fail(t(o))}else i.warn("attempting to call saveEncryptedLocal on empty object."),o.reject()}),o}function r(e,t){var n=t||null;return e.done(function(e){n=e}),n}function o(e,t){var n=this;e.done(function(e){t.call(n,e)}).fail(function(){t.call(n)})}var i=Atalasoft.Logger,s=Atalasoft.Controls.Capture.WebTwain.Service,l=function(e){this.patchCode=e.patchCode||"",this.PatchCode=this.patchCode,this.barcodes=e.barcodes||[],this.Barcodes=this.barcodes,this.imprintedText=e.imprintedText||"",this.ImprintedText=this.imprintedText,this.Filename=e.filename,this.localFile=e.localFile||"",this.localFileChunks=e.localFileChunks,this.originalImage=e.originalImage,this.discard=!1,this.eDoc=e.eDoc,this.path=e.path,e.eDoc?this.filename=this.Filename=e.filename:(this.bitsPerPixel=e.bitsPerPixel||-1,this.BitsPerPixel=this.bitsPerPixel,this.pixelType=e.pixelType||-1,this.PixelType=this.pixelType,this.width=e.width||0,this.Width=this.width,this.height=e.height||0,this.Height=this.height,this.xdpi=e.xdpi||-1,this.XResolution=this.xdpi,this.ydpi=e.ydpi||-1,this.YResolution=this.ydpi,this.dpi=[this.xdpi,this.ydpi],this.PageSide=e.pageSide,"front"in e&&(this.front=e.front),this.SheetNo=e.sheetNo,"sheetNo"in e&&(this.sheetNo=e.sheetNo),"newSheet"in e&&(this.newSheet=e.newSheet))},c={asBase64String:function(e,t){return r.call(this,n.call(this,e,t,!1))},saveEncryptedLocal:function(e,t){return r.call(this,a.call(this,e,t,!1))}},u={asBase64String:function(e,t,a){o.call(this,n.call(this,t,a,!0),e)},saveEncryptedLocal:function(e,t,n){o.call(this,a.call(this,t,n,!0),e)}},d=function(t,n,a){this.id=n,a=a||{},l.call(this,a),this.thumbnailData=new Atalasoft.Controls.Capture.WebTwain.Thumb(this.id,e.extend(!0,a.thumbnailData,{thumb:a.thumb})),this.selfUrl=a.self,this.alternatives=a.alternatives,this.thumbUrl=a.thumb};return d.prototype={updateData:function(e){l.call(this,e)},asBase64String:function(){var e=Array.prototype.slice.call(arguments),t=e.slice(-1).pop();return"function"!=typeof t?c.asBase64String.apply(this,e):(e.unshift(e.pop()),u.asBase64String.apply(this,e),void 0)},saveEncryptedLocal:function(){var e=Array.prototype.slice.call(arguments),t=e.slice(-1).pop();return"function"!=typeof t?c.saveEncryptedLocal.apply(this,e):(e.unshift(e.pop()),u.saveEncryptedLocal.apply(this,e),void 0)},thumbnail:function(e,t){return this.thumbnailData&&this.thumbnailData.requestedWidth===e&&this.thumbnailData.requestedHeight===t||(this.thumbnailData=new Atalasoft.Controls.Capture.WebTwain.Thumb(this.id,{thumb:this.thumbUrl,width:e,height:t,requestedWidth:e,requestedHeight:t})),this.thumbnailData},clear:function(){return this.id&&this.selfUrl?s.del(this.selfUrl,{},!0).done(function(){this.selfUrl=null,this.alternativesUrl=null,this.id=null}):void 0},AsBase64String:function(){return i.deprecate("AsBase64String","asBase64String"),this.asBase64String.apply(this,arguments)},SaveEncryptedLocalFile:function(){return i.deprecate("SaveEncryptedLocalFile","saveEncryptedLocal"),this.saveEncryptedLocal.apply(this,arguments)},Thumbnail:function(){return i.deprecate("Thumbnail","thumbnail"),this.thumbnail.apply(this,arguments)}},d}(jQuery),Atalasoft.Controls.Capture.WebTwain.Thumb=function(){"use strict";var e=Atalasoft.Controls.Capture.WebTwain.Image.prototype,t=function(e,t){this.id=e,t=t||{},n.call(this,t),this.selfUrl=t.thumb,this.thumbUrl=t.thumb},n=function(t){e.updateData.call(this,t),this.base64=t.base64,this.format=t.format,this.jpegCompression=t.jpegCompression,this.quality=t.quality,this.requestedWidth=t.requestedWidth,this.requestedHeight=t.requestedHeight};return t.prototype={updateData:function(e){n.call(this,e)},asBase64String:function(t,n){var a=Array.prototype.slice.call(arguments),r=a.slice(-1).pop();return"function"!=typeof r&&(r=void 0),this.base64&&this.format===t&&(!n||this.jpegCompression===n.jpegCompression&&this.quality==n.quality)?r?r(this.base64):this.base64:e.asBase64String.apply(this,arguments)},saveEncryptedLocal:function(){return e.saveEncryptedLocal.apply(this,arguments)},thumbnail:e.thumbnail,clear:function(){this.id=null,this.selfUrl=null,this.thumbUrl=null,this.base64=null}},t}(),Atalasoft.Controls.Capture.WebTwain.LocalFileApi=function(e){"use strict";function t(e){p=e.file,h=e.files,f=e.splitFile}function n(e){return function(t,n,a){e.reject(),m.warn("Status: %s, Error: %s",n,a)}}function a(t,a,r,o){var i=e.Deferred();return m.scope("LocalFile.asBase64String("+t+","+a+","+r+")",function(){if(p&&t){var e={format:a,jpegCompression:r?r.jpegCompression:void 0,quality:r?r.quality:void 0};g.get(p+"/"+t,e,o).done(function(e){i.resolve(e)}).fail(n(i))}else i.reject()}),i}function r(t,a){var r=e.Deferred();return m.scope("LocalFile.fromBase64String()",function(){m.debug("Base64 string: %s",t),h&&t?g.post(h,{base64:t},a).done(function(e){r.resolve(e.id)}).fail(n(r)):r.reject()}),r}function o(t,a){var r=e.Deferred();return m.scope("LocalFile.splitToChunkFiles("+t+")",function(){f&&t?(a=a||{},g.post(f+"/"+t,a,!0).done(function(e){r.resolve(e)}).fail(n(r))):r.reject()}),r}function i(t){var a=e.Deferred();return m.scope("LocalFile.list()",function(){h?g.get(h,{},t).done(function(e){a.resolve(e)}).fail(n(a)):a.reject()}),a}function s(t,a){var r=e.Deferred();return m.scope("LocalFile.remove("+t+")",function(){p&&t?g.del(p+"/"+t,{},a).done(function(){r.resolve(!0)}).fail(n(r)):r.reject()}),r}function l(t){var a=e.Deferred();return m.scope("LocalFile.removeAll()",function(){h?g.del(h,{},t).done(function(){a.resolve(!0)}).fail(n(a)):a.reject()}),a}function c(t,a){var r=e.Deferred();return m.scope("LocalFile.globalPurgeByAge("+t+")",function(){h?g.del(h+"?age="+t,{},a).done(function(){r.resolve(!0)}).fail(n(r)):r.reject()}),r}function u(e,t){var n=void 0===t?void 0:t;return e.done(function(e){n=e}),n}function d(e,t,n){e.done(function(e){t(e)}).fail(function(){t(n)})}var p,f,h,m=Atalasoft.Logger,g=Atalasoft.Controls.Capture.WebTwain.Service,_={asBase64String:function(e,t,n){return u(a(e,t,n,!1),"")},fromBase64String:function(e){return u(r(e,!1))},list:function(){return u(i(!1))},remove:function(e){return u(s(e,!1),!1)},removeAll:function(){return u(l(!1),!1)},globalPurgeByAge:function(e){return u(c(e,!1),!1)}},C={asBase64StringAsync:function(e,t,n,r){d(a(t,n,r,!0),e,"")},fromBase64StringAsync:function(e,t){d(r(e,!0),t)},listAsync:function(e){d(i(!0),e)},removeAsync:function(e,t){d(s(e,!0),t,!1)},removeAllAsync:function(e){d(l(!0),e,!1)},globalPurgeByAgeAsync:function(e,t){d(c(e,!0),t,!1)},splitToFiles:function(e,t,n){d(o(t,n),e)}};return t.prototype=e.extend({},_,C),t}(jQuery),Atalasoft.Controls.Capture.WebTwain.ScanApi=function(){"use strict";var e,t,n,a,r,o=Atalasoft.Logger,i=Atalasoft.Controls.Capture.WebTwain.Service,s=function(o){e=o.scan,t=o.importFiles,n=o.settingsDialog,a=o.supportedValues,r=o.currentValues};return s.prototype={uninitialize:function(){e=void 0,t=void 0,n=void 0,a=void 0,r=void 0},start:function(t){return o.scope("Scan.start()",function(){i.post(e,t,!0).fail(function(e,t,n){o.error("Scan.start() error "+t+"; "+n),Atalasoft.Controls.Capture.WebTwain.reportBrokenConnection()})}),!0},abort:function(){return o.scope("Scan.abort()",function(){i.del(e,{},!1).fail(function(e,t,n){o.error("Scan.abort() error "+t+"; "+n)})}),!0},importFiles:function(e){return o.scope("Scan.importFiles()",function(){i.post(t,e,!0).fail(function(e,t,n){o.error("Scan.importFiles() error "+t+"; "+n),Atalasoft.Controls.Capture.WebTwain.reportBrokenConnection()})}),!0},showSettingsDialog:function(e,t){return o.scope("Scan.showSettingsDialog()",function(){i.callDeferred(i.post,n,e,t).fail(function(e,n,a){o.error("Scan.showSettingsDialog() error "+n+"; "+a),t({complete:!1}),Atalasoft.Controls.Capture.WebTwain.reportBrokenConnection()})}),!0},getSupportedValues:function(e,t){return o.scope("Scan.getSupportedValues()",function(){i.callDeferred(i.post,a,e,t).fail(function(e,n,a){o.error("Scan.getSupportedValues() error "+n+"; "+a),t({}),Atalasoft.Controls.Capture.WebTwain.reportBrokenConnection()})}),!0},getCurrentValues:function(e,t){return o.scope("Scan.getCurrentValues()",function(){i.callDeferred(i.post,r,e,t).fail(function(e,n,a){o.error("Scan.getCurrentValues() error "+n+"; "+a),t({}),Atalasoft.Controls.Capture.WebTwain.reportBrokenConnection()})}),!0}},s}(),function(e){Atalasoft.Controls.Capture.Uploader=function(e,t,n){if(!(this instanceof arguments.callee))throw new Error("Constructor called as a function");var a=this,r=e;this.callback=t||function(){},this.updating=!1,this.timeout=1e3*(Number(n.serverTimeout)||50),this.abort=function(){a.updating&&(a.updating=!1,a.xhr.abort(),a._serverTimeoutToken&&(clearTimeout(a._serverTimeoutToken),delete a._serverTimeoutToken),a.xhr=null)},this.__onTimeout=function(){a.abort(),a.onTimeout&&a.onTimeout()},this.send=function(e){if(a.updating)return!1;if(a.xhr=null,a.xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),null===a.xhr)return Atalasoft.Controls.Capture.Errors.report(n.onUploadError,Atalasoft.Controls.Capture.Errors.ajax),!1;a.xhr.onreadystatechange=function(){if(4==a.xhr.readyState){a.updating=!1,a._serverTimeoutToken&&(clearTimeout(a._serverTimeoutToken),delete a._serverTimeoutToken);try{a.callback(a.xhr.responseText,a.xhr.status,a.xhr.responseXML)}catch(e){}a.xhr=null}},a.updating=new Date;var t=r+"?"+a.updating.getTime();return a.xhr.open("POST",t,!0),a.xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+a.boundaryString),a.onTimeout&&(a._serverTimeoutToken=setTimeout(a.__onTimeout,a.timeout)),a.xhr.send(e),!0}},Atalasoft.Controls.Capture.UploadToCaptureServer={_params:{},boundaryString:"AaBbCc_X30",dash_boundary:"--AaBbCc_X30",initialize:function(e){this._params=e,this.__bindEvents(!0)},isInitialized:function(){return this._params&&this._params.handlerUrl},dispose:function(){this.__bindEvents(!1),this._params={}},__bindEvents:function(e){var t=this._params.eventBindObject,n=e?t.bind:t.unbind;this._params.onUploadStarted&&n.call(t,"onUploadStarted",e?{}:this._params.onUploadStarted,this._params.onUploadStarted),this._params.onUploadCompleted&&n.call(t,"onUploadCompleted",e?{}:this._params.onUploadCompleted,this._params.onUploadCompleted)},getUploadCallback:function(){return function(e,t){Atalasoft.Controls.Capture.UploadToCaptureServer.uploadToServer(e,t)}},__extensionFromBase64String:function(e){switch(e.substr(0,5)){case"JVBER":return"pdf";case"/9j/4":return"jpg";case"R0lGO":return"gif";case"iVBOR":return"png";case"TU0AK":return"tif";case"SUkqA":return"tif"}return"Qk"==e.substr(0,2)?"bmp":"bin"},uploadToServer:function(e,t){this._params.eventBindObject.trigger("onUploadStarted",{});
var n=this.__extensionFromBase64String(e),a={bmp:"image/bmp",gif:"image/gif",jpg:"image/jpeg",pdf:"application/pdf",png:"image/png",tif:"image/tiff",bin:"application/octet-stream"}[n],r="\r\n"+this.dash_boundary+"\r\n";t||(t=this._params.uploadOptions||{});var o="";if("string"==typeof this._params.uploadLocation&&0!==this._params.uploadLocation.length&&(o+=r+'Content-Disposition: form-data; name="uploadLocation"\r\n\r\n'+this._params.uploadLocation),t.formData)for(var i in t.formData)t.formData.hasOwnProperty(i)&&(o+=r+'Content-Disposition: form-data; name="'+i+'"\r\n\r\n'+this.__encodePartValue(t.formData[i]));if(t.extraParts){var s,l=t.extraParts;for(s=0;s<l.length;s++)o+=r+l[s]}var c=this,u=new Atalasoft.Controls.Capture.Uploader(this._params.handlerUrl,function(e,t){c.__onPostCompleted(e,t)},this._params);u.boundary=this.dash_boundary,u.boundaryString=this.boundaryString;var d=r.concat('Content-Disposition: form-data; name="contentDescription"\r\n\r\nuploaded-document'+o+r+'Content-Disposition: form-data; name="file"; filename="document.'+n+'"\r\nContent-Type: '+a+"\r\nContent-transfer-encoding: base64\r\n\r\n",e,"\r\n"+this.dash_boundary+"--\r\n");u.onTimeout=function(){Atalasoft.Controls.Capture.Errors.report(c._params.onUploadError,Atalasoft.Controls.Capture.Errors.serverNotResponding,{handlerUrl:c._params.handlerUrl,timeout:u.timeout}),c._params.eventBindObject.trigger("onUploadCompleted",{success:!1,responseStatus:598,response:Atalasoft.Controls.Capture.Errors.serverNotResponding})},u.send(d)},__encodePartValue:function(e){return"string"==typeof e||"number"==typeof e?e:JSON.stringify(e)},__onPostCompleted:function(t,n){var a;try{a=e.parseJSON(t)}catch(r){a="parseJSON: "+r.message}200==n?this._params.eventBindObject.trigger("onUploadCompleted",{success:!0,documentFilename:a.filename,response:a}):(Atalasoft.Controls.Capture.Errors.report(this._params.onUploadError,Atalasoft.Controls.Capture.Errors.uploadError,{responseStatus:n,response:a,handlerUrl:this._params.handlerUrl}),this._params.eventBindObject.trigger("onUploadCompleted",{success:!1,responseStatus:n,response:a}))}}}(jQuery),window.XDomainRequest&&(Atalasoft.Controls.Capture.WebTwain.CachedXdrs={NextId:0},jQuery.ajaxTransport(function(e){if(e.crossDomain&&e.async){e.timeout&&(e.xdrTimeout=e.timeout,delete e.timeout);var t,n,a=Atalasoft.Controls.Capture.WebTwain.CachedXdrs;return{send:function(r,o){function i(e,r,i,s){t.onload=t.onerror=t.ontimeout=jQuery.noop,t=void 0,delete a[n],o(e,r,i,s)}t=new XDomainRequest,n=(++a.NextId).toString(),a[n]=t,t.open(e.type,e.url),t.timeout=e.xdrTimeout||Number.MAX_VALUE,t.onprogress=function(){},t.onload=function(){i(200,"OK",{text:t.responseText},"Content-Type: "+t.contentType)},t.onerror=function(){i(500,"Not Found")},t.ontimeout=function(){i(0,"timeout")},setTimeout(function(){t.send(e.hasContent&&e.data||null)},0)},abort:function(){t&&(delete a[n],t.onerror=jQuery.noop,t.abort())}}}}));